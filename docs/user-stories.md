# 2. 👤 사용자 스토리

## 1. 상품 관리

### 1-1 : 상품 정보 조회
**I want** 상품의 가격과 재고를 포함한 정보를 조회하고 싶다.

**So that**  구매 결정을 내릴 수 있다.

**인수 조건:**
- 상품명, 가격, 현재 재고 수량이 표시되어야 한다.
- 재고가 0일 경우 품절 상태로 표시되어야 한다.
- 상품 정보는 n초 이내에 로드되어야 한다.
- 가격은 올바른 통화 형식으로 표시되어야 한다.

---

### 1-2 : 실시간 재고 확인
**I want** 실시간으로 재고를 확인하고 싶다.

**So that** 구매 시도 전에 상품이 구매 가능한지 알 수 있다.

**인수 조건:**
- 다른 사용자가 구매할 때 재고 수량이 실시간으로 업데이트되야 한다.
- oversell을 방지해야 한다. (가용 재고보다 많이 구매할 수 없음)
- 결제 중 재고가 소진되면 명확한 메시지를 전달해야한다.
- 재고 변경사항이 모든 사용자에게 즉시 반영되어야 한다.
- 재고가 n개 이하일 때 "재고 얼마 남지 않음" 경고를 표시해야 한다.

---

### 1-3 : 인기 상품 조회
**I want** 최근 3일간의 인기 상품 Top 5를 확인하고 싶다.

**So that** 사용자에게 인기상품을 보여줄 수 있다.

**인수 조건:**
- 최근 3일 기준,주문 수 기준 상위 5개 상품이 표시한다.
- 매진된 상품은 제외 하고 현재 재고가 있는 상품만 목록에 포함되어야 한다.
- 랭킹은 최소 n시간마다 업데이트되어야 한다.(1시간)

---

## 2. 주문/결제 (Order & Payment)

### 2-1 : 장바구니 관리
**I want** 여러 상품을 장바구니에 추가하고 싶다.

**So that** 한 번의 주문으로 여러 상품을 구매할 수 있다.

**인수 조건:**
- 지정한 수량만큼 상품을 장바구니에 추가할 수 있어야 한다.
- 상품 수량을 수정할 수 있어야 한다.
- 상품을 삭제할 수 있어야 한다.
- 모든 상품의 총 금액이 표시되어야 한다.
- 품절된 상품이 있으면 장바구니에서 표시되어야 한다.
- 빈 장바구니일 때 "장바구니가 비어있습니다." 메시지가 표시되어야 한다.

---

### 2-2 : 주문 생성 및 재고 차감
**I want** 재고가 있을 때만 주문이 확정되길 원한다.

**So that** 구매 불가능한 상품에 대한 주문 확정을 받지 않을 수 있다.

**인수 조건:**
- 주문 확정 전에 시스템이 재고 가용성을 검증해야 한다.
- 주문 확정 시 재고가 원자적으로 차감되어야 한다.
- 주문 도중 품절 상품이 있을 경우 주문이 실패하고 실패 메시지를 표시해야 한다.
- 재고 차감과 주문 생성은 단일 트랜잭션으로 처리되어야 한다.
- 동시에 여러 주문이 발생해도 과매도가 발생하지 않아야 한다.
- 주문 실패 시 장바구니는 그대로 유지되어야 한다.


---

### 2-3 : 잔액 기반 결제
**I want** 계정 잔액을 사용하여 주문 대금을 결제하고 싶다.

**So that** 외부 결제 수단 없이 구매를 완료할 수 있다.

**인수 조건:**
- 결제 전에 잔액이 충분한지 확인해야 한다.
- 잔액이 부족하면 결제가 실패해야 한다.
- 주문 확정과 동시에 사용자 잔액이 원자적으로 차감되어야 한다.
- 잔액 차감과 재고 차감은 단일 트랜잭션으로 처리되어야 한다.
- 사용자는 음수 잔액을 가질 수 없어야 한다.
- 결제 내역은 시간과 함께 기록되어야 한다.
- 결제 완료 후 영수증 또는 주문 확인서가 제공되어야 한다.

---

### 2-4 : 쿠폰 할인 적용
**I want** 주문에 쿠폰을 적용하고 싶다.

**So that** 구매 시 할인을 받을 수 있다.

**인수 조건:**
- 결제 단계에서 유효한 쿠폰을 선택하고 적용할 수 있어야 한다.
- 할인 금액이 결제 전에 계산되어 표시되어야 한다.
- 쿠폰이 검증되어야 한다. (만료되지 않음, 이미 사용하지 않음)
- 결제 성공 후 쿠폰이 사용 완료로 표시되어야 한다.
- 주문당 하나의 쿠폰만 적용할 수 있어야 한다.
- 할인 후 최종 금액이 명확하게 표시되어야 한다.
- 최소 주문 금액 조건이 있는 경우 이를 충족해야 쿠폰을 사용할 수 있어야 한다.

---

## 3. 쿠폰 (Coupon)

### 3-1 : 선착순 쿠폰 발급
**I want** 한정 수량의 쿠폰을 발급받고 싶다.

**So that** 구매 시 쿠폰을 통해 할인을 받을 수 있다.

**인수 조건:**
- 쿠폰은 선착순으로 발급되어야 한다.
- 시스템은 가용 수량보다 많은 쿠폰이 발급되는 것을 방지해야 한다.
- 수량이 소진되면 사용자에게 "품절" 메시지를 명확히 표시해야 한다.
- 각 사용자는 동일한 쿠폰을 한 번만 받을 수 있어야 한다.
- 쿠폰 발급은 원자적이어야 한다. (경쟁 상태 방지)
- 발급된 쿠폰은 사용자의 쿠폰 목록에 즉시 표시되어야 한다.
- 발급 성공 시 쿠폰의 유효기간이 표시되어야 한다.

---

### 3-2 : 쿠폰 유효성 검증
**I want** 주문에 적용하기 전에 쿠폰의 유효성을 검증하고 싶다.

**So that** 유효한 쿠폰만 사용할 수 있다.

**인수 조건:**
- 만료된 쿠폰은 사용할 수 없어야 한다.
- 이미 사용한 쿠폰은 재사용할 수 없어야 한다.
- 사용자가 소유하지 않은 쿠폰은 적용할 수 없어야 한다.
- 검증 오류는 명확하고 사용자 친화적인 메시지를 제공해야 한다.
- 검증은 최종 결제 처리 전에 수행되어야 한다.
- 최소 주문 금액 조건이 있는 쿠폰의 경우 조건을 만족하지 않으면 쿠폰을 적용할 수 없어야 한다.

---

### 3-3 : 쿠폰 사용 이력 조회
**I want** 쿠폰 사용 이력을 조회하고 싶다.

**So that** 어떤 쿠폰을 사용했고 언제 사용했는지 추적할 수 있다.

**인수 조건:**
- 사용자에게 발급된 모든 쿠폰 목록이 표시되어야 한다.
- 상태(사용 가능, 사용 완료, 만료)가 표시되어야 한다.
- 사용 가능한 쿠폰의 경우 만료 날짜가 표시되어야 한다.
- 목록은 상태(사용 가능 우선)와 날짜로 정렬되어야 한다.
- 각 쿠폰의 할인 금액 또는 할인율이 표시되어야 한다.
- 쿠폰에 대한 정보가 명확히 표기되어야 한다.

---

## 4. 데이터 연동 (Data Integration)

### 4-1 : 주문 데이터 외부 전송
**I want** 주문 데이터가 외부 시스템으로 전송되길 원한다.

**So that**  주문 정보를 처리할 수 있다.

**인수 조건:**
- 주문 생성 성공 후 외부 시스템으로 데이터가 전송되어야 한다.
- 외부 전송이 실패해도 주문은 정상적으로 생성되어야 한다.
- 외부 전송은 주문의 성공실패에 영향을 끼치지 말아야 하므로 비동기로 처리되어야 한다.
- 전송 데이터에는 주문 ID, 상품 정보, 금액, 타임스탬프등의 주문정보를 포함해야 한다.
- 성공한 전송은 감사 로그에 기록되어야 한다.
- 전송 실패 시 알림 또는 알람이 발생해야 한다.

---

## 5. 사용자 관리

### 5-1 : 잔액 충전
**I want** 계정 잔액을 충전하고 싶다.

**So that** 플랫폼에서 상품을 구매할 수 있다.

**인수 조건:**
- 사용자가 충전할 금액을 지정할 수 있어야 한다.
- 충전 성공 후 잔액이 즉시 업데이트되어야 한다.
- 충전 금액은 양수여야 한다. (최소 1,000원 이상)
- 잔액 증가가 거래 내역에 기록되어야 한다.
- 동시 충전 요청 시에도 경쟁 상태가 발생하지 않아야 한다.
- 충전 완료 후 현재 잔액이 표시되어야 한다.
- 충전 내역에 날짜와 시간이 기록되어야 한다.

---

### 5-2 : 잔액 조회
**I want** 현재 계정 잔액을 조회하고 싶다.

**So that** 구매 가능한 금액을 확인할 수 있다.

**인수 조건:**
- 현재 잔액이 명확하게 표시되어야 한다.
- 최근 거래 내역(충전, 결제)이 함께 표시되어야 한다.
- 잔액은 실시간으로 업데이트되어야 한다.
- 거래 내역에는 날짜, 금액, 거래 유형이 포함되어야 한다.
- 과거 거래 내역을 조회할 수 있어야 한다.

---


### 5-3 : 주문 상태 확인
**I want** 주문 상태를 확인하고 싶다.

**So that** 나의 주문이 어떻게 진행되고 있는지 알 수 있다.

**인수 조건:**
- 주문 목록에서 각 주문의 현재 상태가 표시되어야 한다.
- 상태: 결제 대기, 결제 완료, 배송 준비, 배송 중, 배송 완료, 취소됨
- 주문 상세 페이지에서 주문 내역과 상태 변경 이력이 표시되어야 한다.
- 주문 상태 변경 시 알림을 받을 수 있어야 한다.

---

## 6. 기타 

### 6-1 : 에러처리
**I want** 오류 발생 시 명확한 안내를 받고 싶다.

**So that** 무엇이 잘못되었는지 이해하고 조치를 취할 수 있다.

**인수 조건:**
- 모든 오류 메시지는 사용자가 이해할 수 있어야한다.
- 오류 발생 시 다음 단계(예: 재시도, 고객센터 문의)에 대해 안내해야 한다.
- 네트워크 오류, 서버 오류, 유효성 오류가 구분되어야 한다.
